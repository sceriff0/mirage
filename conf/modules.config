/*
========================================================================================
    Process-specific Resource Configuration
========================================================================================
    Direct SLURM resource allocation for each process
========================================================================================
*/

process {

    /*
    ================================================================================
        Resource Labels (used by processes)
    ================================================================================
    */

    withLabel: 'process_low' {
        cpus   = 2
        memory = '4.GB'
        time   = '1.h'
    }

    withLabel: 'process_medium' {
        cpus   = 4
        memory = '16.GB'
        time   = '4.h'
    }

    withLabel: 'process_high' {
        cpus   = 8
        memory = '32.GB'
        time   = '8.h'
    }

    withLabel: 'gpu' {
        cpus           = 8
        memory         = '64.GB'
        time           = '12.h'
        clusterOptions = '--gres=gpu:1'
    }

    /*
    ================================================================================
        Pipeline Processes
    ================================================================================
    */

    withName: 'PREPROCESS' {
        cpus   = 4
        memory = '16.GB'
        time   = '2.h'
    }

    withName: 'REGISTER' {
        cpus   = 8
        memory = '256.GB'
        time   = '24.h'
    }

    withName: 'SEGMENT' {
        cpus   = 8
        memory = '32.GB'
        time   = '6.h'
        // Automatically adds GPU based on params.seg_gpu
        clusterOptions = { params.seg_gpu ? '--gres=gpu:1' : '' }
    }

    withName: 'QUANTIFY' {
        cpus   = 4
        memory = '16.GB'
        time   = '4.h'
        // Automatically adds GPU based on params.quant_gpu
        clusterOptions = { params.quant_gpu ? '--gres=gpu:1' : '' }
    }

    withName: 'PHENOTYPE' {
        cpus   = 4
        memory = '16.GB'
        time   = '2.h'
    }
}

/*
========================================================================================
    Resource Override Examples
========================================================================================

    Override resources for a specific run:

    1. Via custom config file:
       nextflow run main.nf -profile slurm -c custom.config

       Where custom.config contains:
       ─────────────────────────────────────────────
       process {
           withName: 'SEGMENT' {
               memory = '128.GB'
               time   = '24.h'
               cpus   = 16
           }
       }
       ─────────────────────────────────────────────

    2. Via ext.args for script parameters:
       ─────────────────────────────────────────────
       process {
           withName: 'SEGMENT' {
               ext.args = '--gamma 0.8 --crop_size 12000'
           }
       }
       ─────────────────────────────────────────────

    3. Via command line parameters:
       nextflow run main.nf -profile slurm \
         --seg_crop_size 10000 \
         --quant_min_area 50

========================================================================================
*/
