/*
========================================================================================
    Base Process Configuration
========================================================================================
    Default settings for SLURM execution
========================================================================================
*/

process {
    // Executor
    executor = 'slurm'

    // Error handling strategy - retry on resource exhaustion, finish on other errors
    errorStrategy = {
        task.exitStatus in [
            104,  // Connection reset
            134,  // SIGABRT (abort signal)
            137,  // SIGKILL (out of memory)
            139,  // SIGSEGV (segmentation fault)
            140,  // SIGTERM
            143   // SIGTERM (job killed)
        ] ? 'retry' : 'finish'
    }
    maxRetries = 2
    maxErrors  = '-1'

    // Default resource requirements
    cpus   = { check_max( 1    * task.attempt, 'cpus'   ) }
    memory = { check_max( 6.GB * task.attempt, 'memory' ) }
    time   = { check_max( 4.h  * task.attempt, 'time'   ) }

    // SLURM defaults (can be overridden by profile or params)
    queue          = null
    clusterOptions = null
}

/*
========================================================================================
    Executor Configuration
========================================================================================
*/

executor {
    name            = 'slurm'
    queueSize       = 100              // Max concurrent jobs
    submitRateLimit = '10 sec'         // Max 10 job submissions per second
    exitReadTimeout = '100000000 sec'    // Wait time for job status
}

/*
========================================================================================
    Notes
========================================================================================

    SLURM Error Codes Handled:
    - 143: SIGTERM (job killed)
    - 137: SIGKILL (out of memory)
    - 104: Connection reset
    - 134: SIGABRT (abort)
    - 139: SIGSEGV (segmentation fault)

    These errors trigger automatic retry (up to maxRetries=2)
========================================================================================
*/
