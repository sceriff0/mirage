/*
========================================================================================
    Test Profile Configuration
========================================================================================
    Minimal resource requirements for local testing
========================================================================================
*/

params {
    config_profile_name        = 'Test profile'
    config_profile_description = 'Minimal test dataset to check pipeline function'

    // Limit resources for local testing
    max_cpus   = 2
    max_memory = '6.GB'
    max_time   = '1.h'

    // Test input data
    input  = 'tests/testdata/test_input.csv'
    outdir = './test_results'

    // Disable GPU for local testing
    seg_gpu        = false
    quant_gpu      = false

    // Reduce computational requirements
    preproc_tile_size         = 512
    preproc_n_iter            = 1

    // Use smaller dimensions for registration
    gpu_reg_affine_crop_size  = 2000
    gpu_reg_diffeo_crop_size  = 1000

    // Smaller segmentation tiles
    seg_n_tiles_y             = 4
    seg_n_tiles_x             = 4

    // Enable QC but downsampled
    skip_registration_qc      = false
    qc_scale_factor           = 0.1
}

process {
    executor = 'local'

    cpus   = { check_max( 1, 'cpus' ) }
    memory = { check_max( 2.GB, 'memory' ) }
    time   = { check_max( 30.m, 'time' ) }

    withLabel: 'process_medium' {
        cpus   = 2
        memory = 4.GB
        time   = 1.h
    }

    withLabel: 'gpu' {
        // Override GPU processes to run on CPU for testing
        cpus   = 2
        memory = 4.GB
    }
}

docker.enabled = true
