params {
    input = './data/*.nd2'
    preproc_normalize = true
    preproc_tile_size = 512
    preproc_pool_workers = 4
    seg_model = 'cellpose'
    seg_gpu = true
}

// nf-core style nextflow.config

manifest {
    name = 'ateia'
    description = 'WSI processing pipeline (preprocessing, registration, segmentation, quantification, phenotyping)'
    author = 'ateia team'
    version = '0.1.0'
}

// Default parameters (can be overridden on the CLI)
params {
    input = './data/*.nd2'               // glob pattern for input images
    outdir = './results'                 // pipeline output directory

    // Preprocessing
    preproc_normalize = true
    preproc_tile_size = 512
    preproc_pool_workers = 4

    // Segmentation
    seg_model = 'cellpose'
    seg_gpu = true

    // General
    threads = 4
    // Quantification GPU flag
    quant_gpu = false
}

// Per-stage container images (can be overridden via CLI e.g. --container.preprocess 'repo/image:tag')
params.container = [
    preprocess: 'docker.io/library/python:3.9-slim',
    registration: 'docker.io/library/python:3.9-slim',
    segmentation: 'docker.io/ateia/segment:latest',
    quantification: 'docker.io/ateia/quant:latest',
    phenotyping: 'docker.io/ateia/pheno:latest'
]

// Default executor and resource defaults
process {
    executor = 'local'
    cpus = params.threads
    memory = '8 GB'
    time = '2h'
}

// Named profiles
profiles {
    // Local development
    standard {
        process.executor = 'local'
    }

    // SLURM cluster with GPU resources
    slurm {
        includeConfig 'conf/cluster_slurm_gpus.config'
    }

    // Use when GPU label is required on processes
    gpu {
        // processes can set `label 'gpu'` and this profile maps it on the cluster
    }

    // Docker profile (example)
    docker {
        process.executor = 'local'
        process.container = 'quay.io/biocontainers/python:3.8'
    }
}

// Mapping of process labels to resources (nf-core likes labels)
// Note: Nextflow expects resource directives inside processes or profile configs. 
// Maintain resource mappings in `conf/` profile configs (e.g. conf/cluster_slurm_gpus.config).
