// Module-specific configuration
// Use withName selectors to customize process resources or ext.args
process {
    // Example: map a module's ext.args via withName selector
    // Replace the regex with the extended execution path if needed for specificity
    withName: '.*SEGMENT_PROC' {
        cpus = 8
        memory = '32 GB'
    }

    withName: '.*QUANT_PROC' {
        cpus = 4
        memory = '16 GB'
    }

    withName: '.*PHENO_PROC' {
        cpus = 4
        memory = '16 GB'
    }

    // Process resource overrides taken from pipeline params (test vs normal).
    withName: 'apply_padding' {
        memory = params.test ? '8 GB' : '50 GB'
    }

    withName: 'affine' {
        memory = params.test ? '5 GB' : '70 GB'
    }

    withName: 'diffeomorphic' {
        // Use null array for local executor, otherwise set to '50' (string) for cluster.
        array = (params.executor == 'local') ? null : '50'
    }

    withName: 'stitching' {
        memory = params.test ? '5 GB' : '60 GB'
    }

    withName: 'quality_control' {
        memory = params.test ? '20 GB' : '60 GB'
    }

    withName: 'stacking' {
        memory = params.test ? '5 GB' : '60 GB'
    }
}

// Example of module arguments exposed via ext.args (modules can read ext.args)
ext {
    // segmentation: '--model cellpose --some-flag'
}
